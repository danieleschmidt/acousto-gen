# Acousto-Gen Deployment Guide

## Overview

This guide provides comprehensive instructions for deploying Acousto-Gen in production environments. The system supports multiple deployment configurations to meet different use cases.

## Quick Start

### Standard Production Deployment

```bash
# Clone and deploy
git clone https://github.com/danieleschmidt/acousto-gen.git
cd acousto-gen
chmod +x scripts/deploy.sh
./scripts/deploy.sh standard your-domain.com production
```

### GPU-Accelerated Deployment

```bash
./scripts/deploy.sh gpu your-domain.com production
```

### Distributed Cluster Deployment

```bash
./scripts/deploy.sh cluster your-domain.com production
```

## Deployment Types

### 1. Standard Production
- Single-node deployment
- CPU-based processing
- PostgreSQL + Redis
- HTTPS with SSL/TLS
- Monitoring with Grafana + Prometheus

### 2. GPU-Accelerated
- NVIDIA GPU support
- CUDA-optimized containers
- Multi-GPU processing
- Ideal for intensive computations

### 3. Distributed Cluster
- Multi-node processing
- Automatic load balancing
- Fault-tolerant job scheduling
- Scalable worker nodes

### 4. Development Environment
- Hot-reload enabled
- Debug logging
- Development tools included
- Self-signed certificates

## Prerequisites

### System Requirements

**Minimum Requirements:**
- 4 CPU cores
- 8 GB RAM
- 50 GB storage
- Ubuntu 20.04+ or CentOS 8+

**Recommended for Production:**
- 8+ CPU cores
- 32 GB RAM
- 200 GB SSD storage
- Dedicated GPU (for GPU deployment)

### Software Dependencies

```bash
# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# For GPU support
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update && sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

## Configuration

### Environment Variables

The deployment script generates a `.env` file with secure defaults:

```bash
# Security
JWT_SECRET_KEY=<auto-generated>
ACOUSTO_ADMIN_PASSWORD=<auto-generated>
DB_PASSWORD=<auto-generated>
REDIS_PASSWORD=<auto-generated>

# Application
ACOUSTO_ENV=production
ACOUSTO_DOMAIN=your-domain.com
ACOUSTO_DEBUG=false
ACOUSTO_ENABLE_HTTPS=true

# Performance
ACOUSTO_MAX_WORKERS=4
ACOUSTO_WORKER_MEMORY_LIMIT=8G
```

### SSL Certificates

**For Production:**
1. Obtain certificates from a Certificate Authority
2. Place `cert.pem` and `key.pem` in the `ssl/` directory

**For Development:**
Self-signed certificates are automatically generated

### Hardware Configuration

**USB Device Access:**
```bash
# Add user to dialout group for serial port access
sudo usermod -a -G dialout $USER

# Restart Docker service
sudo systemctl restart docker
```

**GPU Access:**
```bash
# Verify NVIDIA driver installation
nvidia-smi

# Test Docker GPU access
docker run --rm --gpus all nvidia/cuda:11.8-base-ubuntu20.04 nvidia-smi
```

## Service Architecture

### Core Services

1. **acousto-gen-api**: Main application server
2. **postgres**: PostgreSQL database
3. **redis**: Caching and task queue
4. **prometheus**: Metrics collection
5. **grafana**: Monitoring dashboard
6. **nginx**: Reverse proxy with SSL

### Optional Services

1. **acousto-gen-gpu**: GPU computation service
2. **acousto-worker**: Distributed worker nodes
3. **fluentd**: Log aggregation
4. **security-scanner**: Security monitoring

## Network Configuration

### Port Mapping

```bash
# External ports
80   -> HTTP (redirects to HTTPS)
443  -> HTTPS (main application)
3000 -> Grafana dashboard
9090 -> Prometheus metrics

# Internal ports (container network)
5432 -> PostgreSQL
6379 -> Redis
8000 -> API server
8001 -> GPU service
```

### Firewall Rules

```bash
# Allow HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Allow monitoring (optional)
sudo ufw allow 3000/tcp
sudo ufw allow 9090/tcp

# Enable firewall
sudo ufw enable
```

## Security Configuration

### Authentication & Authorization

- **Role-Based Access Control (RBAC)**
- **JWT Token Authentication**
- **API Key Management**
- **Session Management**

### Security Headers

```nginx
# Automatically applied
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000
```

### Rate Limiting

```nginx
# API endpoints limited to 10 requests/second
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
```

## Monitoring & Observability

### Metrics Collection

**System Metrics:**
- CPU, Memory, Disk usage
- Network traffic
- Container health

**Application Metrics:**
- API response times
- Request rates
- Error rates
- Queue lengths

**Hardware Metrics:**
- GPU utilization
- Temperature monitoring
- Power consumption

### Dashboards

Access monitoring at `https://your-domain.com/monitoring`

**Available Dashboards:**
- System Overview
- API Performance
- Hardware Status
- Security Events
- User Activity

### Alerting

Configured alerts for:
- High CPU/Memory usage
- Service downtime
- Security violations
- Hardware failures
- Safety threshold breaches

## Backup & Recovery

### Database Backup

```bash
# Automated daily backups
docker-compose exec postgres pg_dump -U acousto acousto_gen > backup_$(date +%Y%m%d).sql

# Restore from backup
docker-compose exec -T postgres psql -U acousto -d acousto_gen < backup_20231215.sql
```

### Application Data Backup

```bash
# Backup data directory
tar -czf data_backup_$(date +%Y%m%d).tar.gz data/

# Backup configuration
tar -czf config_backup_$(date +%Y%m%d).tar.gz config/ .env ssl/
```

### Disaster Recovery

1. **Infrastructure Recovery:**
   ```bash
   # Restore from backups
   ./scripts/deploy.sh standard your-domain.com production
   
   # Restore data
   tar -xzf data_backup_latest.tar.gz
   ```

2. **Database Recovery:**
   ```bash
   # Restore database
   docker-compose exec -T postgres psql -U acousto -d acousto_gen < backup_latest.sql
   ```

## Maintenance

### Updates

```bash
# Pull latest images
docker-compose pull

# Update services
./scripts/deploy.sh standard your-domain.com production

# Check health
docker-compose ps
curl -k https://your-domain.com/health
```

### Log Management

```bash
# View logs
docker-compose logs -f acousto-gen-api

# Log rotation (automatic with fluentd)
docker-compose logs --tail=100 acousto-gen-api

# Clear logs
docker system prune -f
```

### Performance Tuning

**CPU Optimization:**
```yaml
# docker-compose.yml
deploy:
  resources:
    limits:
      cpus: '8'
    reservations:
      cpus: '4'
```

**Memory Optimization:**
```bash
# Increase worker memory
export ACOUSTO_WORKER_MEMORY_LIMIT=16G

# Enable memory monitoring
export ACOUSTO_ENABLE_MEMORY_PROFILING=true
```

**GPU Optimization:**
```yaml
# Enable multi-GPU
environment:
  - ACOUSTO_ENABLE_MULTI_GPU=true
  - CUDA_VISIBLE_DEVICES=0,1,2,3
```

## Troubleshooting

### Common Issues

**Service Won't Start:**
```bash
# Check logs
docker-compose logs service-name

# Verify configuration
docker-compose config

# Rebuild container
docker-compose build service-name
```

**SSL Certificate Issues:**
```bash
# Verify certificate
openssl x509 -in ssl/cert.pem -text -noout

# Test SSL connection
openssl s_client -connect your-domain.com:443
```

**Database Connection Issues:**
```bash
# Check database status
docker-compose exec postgres pg_isready -U acousto

# Reset database
docker-compose down -v
docker-compose up -d postgres
```

**GPU Not Detected:**
```bash
# Check NVIDIA driver
nvidia-smi

# Verify Docker GPU support
docker run --rm --gpus all nvidia/cuda:11.8-base-ubuntu20.04 nvidia-smi

# Restart Docker service
sudo systemctl restart docker
```

### Performance Issues

**High CPU Usage:**
1. Check for infinite loops in logs
2. Increase worker count
3. Optimize algorithms
4. Enable profiling

**Memory Leaks:**
1. Monitor memory usage trends
2. Enable memory profiling
3. Restart services periodically
4. Optimize data structures

**Slow API Response:**
1. Check database query performance
2. Enable caching
3. Optimize network configuration
4. Scale horizontally

## Support & Documentation

### Getting Help

1. **Documentation**: Check README.md and API docs at `/docs`
2. **Logs**: Always check service logs first
3. **Health Checks**: Use `/health` endpoint
4. **Monitoring**: Check Grafana dashboards

### Best Practices

1. **Security**: 
   - Change default passwords
   - Keep certificates updated
   - Regular security scans

2. **Performance**: 
   - Monitor resource usage
   - Optimize based on workload
   - Plan for scaling

3. **Reliability**: 
   - Regular backups
   - Health monitoring
   - Disaster recovery testing

4. **Maintenance**: 
   - Regular updates
   - Log rotation
   - Performance tuning

## Production Checklist

### Pre-Deployment
- [ ] SSL certificates obtained and installed
- [ ] DNS configured and tested
- [ ] Firewall rules configured
- [ ] Hardware compatibility verified
- [ ] Backup strategy implemented

### Post-Deployment
- [ ] Change default admin password
- [ ] Configure monitoring alerts
- [ ] Test backup/restore procedures
- [ ] Security scan completed
- [ ] Performance baseline established
- [ ] Documentation updated

### Ongoing Maintenance
- [ ] Regular security updates
- [ ] Monitor system metrics
- [ ] Review access logs
- [ ] Update certificates before expiry
- [ ] Test disaster recovery procedures

---

For additional support, please refer to the project documentation or contact the development team.